<header class="navbar-fixed-top">
  <div class="container">
    <div class="pull-left application-name"><%= link_to "DANGLAY", root_path %></div>
    <nav>
      <ul id="header-nav" , class="nav navbar-nav pull-right">
        <li><%= link_to "Home", root_path %></li>

        <!-- -->

        <% if is_registered? && user_cabpool_exists? %>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <div class="glyphicon glyphicon-bell">
                  <% if current_user.cabpool.requested_users.size != 0%>
                    <span class = 'badge badge_notify'>
                      <%=  current_user.cabpool.requested_users.size%>
                    </span>
                  <%end%>
                </div>
              </a>
              <ul class="dropdown-menu">
                <% if current_user.cabpool.requested_users.empty? %>
                    <li>You have no notifications! </li>
                <% else %>
                    <% current_user.cabpool.requested_users.each do |user| %>
                        <li  class = "notification-row" >
                          <p><%= user.name %> from <%= user.locality.name%> has requested for a cabpool</p>
                          <div class = 'inline_block'>
                          <%=form_tag controller: "cabpools", action: "approve_via_notification", method: 'post'  do %>
                              <%= hidden_field_tag "user_id", user.id %>
                              <%= submit_tag 'Approve' , class: "btn"%>
                          <% end %>
                          </div>
                          <div class = 'inline_block'>
                          <%=form_tag controller: "cabpools", action: "reject_via_notification", method: 'post'  do %>
                              <%= hidden_field_tag "user_id", user.id %>
                              <%= submit_tag 'Reject' , class: "btn" %>
                          <% end %>
                        </div>
                        </li>
                    <% end %>
                <% end %>
              </ul>
            </li>
        <% end %>

        <!-- -->

        <% if is_logged_in? %>
            <li><%= link_to "Logout", logout_path, method: "delete" %></li>
        <% end %>
      </ul>
    </nav>
  </div>

</header>

<script>
$('.dropdown-toggle').click(function() {
    var dropdownList = $('.dropdown-menu');
    var dropdownOffset = $(this).offset();
    var offsetLeft = dropdownOffset.left;
    var dropdownWidth = dropdownList.width();
    var docWidth = $(window).width();

    var subDropdown = $('.dropdown-menu').eq(1);
    var subDropdownWidth = subDropdown.width();

    var isDropdownVisible = (offsetLeft + dropdownWidth <= docWidth);
    var isSubDropdownVisible = (offsetLeft + dropdownWidth + subDropdownWidth <= docWidth);

    if (!isDropdownVisible || !isSubDropdownVisible) {
        $('.dropdown-menu').addClass('pull-right');
    } else {
        $('.dropdown-menu').removeClass('pull-right');
    }
});
</script>
