$(document).on('click', 'a.dropdown-toggle', function (){
    var dropdownList = $('.dropdown-menu');
    var dropdownOffset = $(this).offset();
    var offsetLeft = dropdownOffset.left;
    var dropdownWidth = dropdownList.width();
    var docWidth = $(window).width();

    var subDropdown = $('.dropdown-menu').eq(1);
    var subDropdownWidth = subDropdown.width();

    var isDropdownVisible = (offsetLeft + dropdownWidth <= docWidth);
    var isSubDropdownVisible = (offsetLeft + dropdownWidth + subDropdownWidth <= docWidth);

    if (!isDropdownVisible || !isSubDropdownVisible) {
        $('.dropdown-menu').addClass('pull-right');
    }
    else {
        $('.dropdown-menu').removeClass('pull-right');
    }
});

var func = function(){

  $('.view-details').click(function(){

    if($(this).hasClass('active-view')){
      $(this).removeClass('active-view');
      $(this).parents('.pool-title').next('.pool-description').slideUp('fast');
      $(this).text('More details');

    }else{
      $(this).addClass('active-view');
      $(this).parents('.pool-title').next('.pool-description').slideDown('fast');
      $(this).text('Close');
      initMap_show($(this).parents('.pool-title').next('.pool-description').find('div.map-wrap'));
    }
  });

  $('.user-profile .user-btn,.notification .noti').focus(function(){
    $(this).next('ul').fadeIn('fast');
  });
  $('.user-profile .user-btn,.notification .noti').focusout(function(){
    $(this).next('ul').fadeOut('fast');
  });

  var width = $('body').innerWidth();
  if(width < 1020){
    $('.pool-title').click(function(){
      $(this).next('.pool-description').slideToggle('fast');
      $(this).toggleClass('grey-bg');
      if($(this).hasClass('grey-bg')) {
        initMap_show($(this).next('.pool-description').find('div.map-wrap'));
      }
    });
    $('.pool-list ul li .pool-title button').click(function(e){e.stopPropagation();});
  }
};

$(document).ready(func);
$(document).on("page:load", func);